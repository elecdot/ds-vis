# ANIMATION_REQUIREMENTS — 动画要求与教学规范（v0.1）

## 1. 动画目标

本项目的动画服务于**教学演示**，目标是：

1. 让初学者清晰地理解每一步结构变化过程，而不仅是看到结果。
2. 为教师或学习者提供合适的讲解节奏（自动播放 / 单步 / 回看）。
3. 在不同数据结构之间保持一致的视觉语言与交互模式。

---

## 2. 动画精细度等级

定义三个精细度等级：

- **L1：结果级动画**
  - 仅在操作前后给出两个状态，使用简单过渡。
- **L2：教学级动画（本项目的默认目标）**
  - 将一个操作拆成 3–8 个“微步骤”（micro-steps）。
  - 每一步有明确的视觉焦点（高亮、移动、标注）。
- **L3：深度解剖级动画**
  - 展示内部实现细节（指针字段、平衡因子更新、内存地址等）。

本项目当前统一采用 **L2 教学级动画** 作为目标。  
L3 作为扩展方向，不纳入当前课程设计必做范围。

---

## 3. 各数据结构的 L2 动画要求（示例）

以下仅为 v0.1 示例，后续可根据需要细化。

### 3.1 顺序表插入

操作：在位置 `i` 插入元素 `x`。

建议 micro-steps：

1. 高亮数组中位置 `i`。
2. 高亮将被右移的元素区间 `[i..end]`。
3. 动画展示：`[i..end]` 元素整体向右平移一个单位。
4. 新元素 `x` 从外侧飞入插入位置。
5. 取消高亮，展示新的顺序表。

### 3.2 单链表插入

操作：在节点 `p` 后插入新节点 `x`。

1. 高亮节点 `p` 及其 `next` 指针。
2. 创建新节点 `x`（从侧边淡入或飞入）。
3. 动画显示：`x.next = p.next`（箭头指向原后继节点）。
4. 动画显示：`p.next = x`（箭头从 `p` 指向 `x`）。
5. 取消高亮，展示最终链表。

删除操作可按“高亮 → 重新连线 → 被删除节点淡出”的模式设计。

### 3.3 栈 push / pop

- Push：
  1. 高亮当前栈顶位置。
  2. 新元素从上方下降到栈顶。
  3. 栈顶指示符（TOP）上移一格。

- Pop：
  1. 高亮栈顶元素。
  2. 栈顶元素上升并淡出。
  3. TOP 指示符下降一格。

### 3.4 BST 查找与插入

- 查找：
  1. 每访问一个节点时，该节点高亮。
  2. 使用临时提示（< / > / =）标明比较结果。
  3. 动画箭头指向下一个要访问的子节点（左或右）。
  4. 直到找到目标或确定不存在。

- 插入：
  - 前半段与查找相同。
  - 在最终空位处淡入新节点（可从虚线轮廓变为实体节点）。

### 3.5 BST 删除（需特别教学化）

- 叶子节点：
  1. 高亮目标节点。
  2. 高亮其父节点及对应子指针。
  3. 删除边和节点（节点淡出，父节点指针变空）。
- 单子树：
  1. 高亮目标节点及唯一子节点。
  2. 显示“子树上移”的视觉效果（子节点平移到目标位置）。
- 双子树：
  1. 高亮目标节点。
  2. 高亮中序前驱或后继路径上的节点。
  3. 强调“值替换”与“后续删除”两个阶段（可分为两段动画）。

### 3.6 AVL 旋转

对失衡节点：

1. 高亮失衡节点及其相关子树。
2. 显示当前失衡类型（LL/LR/RL/RR）的文字提示（可选）。
3. 进行旋转动画：子树节点整体平移到新位置，保持层级结构。
4. （可选）更新平衡因子显示。

### 3.7 哈夫曼树构建

对每一步合并：

1. 高亮权值最小的两节点。
2. 将两节点向上“汇聚”到一个新父节点。
3. 更新候选集合的显示。

### 3.8 Git 教学操作动画（新增）

本项目支持展示 Git 内部数据结构在一组虚拟操作下的变化过程，用于教学目的。
所有动画遵循 L2 教学级要求，将 Git 命令拆解为若干 micro-steps。

#### git init
1. 创建一个空 DAG 区域。
2. 创建 main 分支引用（branch label）。
3. HEAD 指向 main。

#### git commit -m "<msg>"
1. 高亮 HEAD 指向的 commit（或空仓库时的 main）。
2. 在同一 lane 上方生成新 commit 节点。
3. 绘制从父 commit 到新 commit 的边。
4. 将 branch label 移动到新 commit。
5. 将 HEAD 移动到 branch label。

#### git branch <name>
1. 高亮 HEAD 所在 commit。
2. 在该 commit 旁展示新分支 label。
3. 加入提示文字：“branch <name> 指向当前提交”。

#### git checkout <branch>
1. 高亮当前 HEAD 与目标分支 label。
2. 将 HEAD label 从原分支移动到目标分支。
3. 高亮目标 commit。
4. 若进入 detached 状态：
   - 直接将 HEAD 指向 commit 节点。
   - 显示提示：“detached HEAD”。

#### git merge <branch>（简化无冲突版本）
1. 高亮当前分支 HEAD。
2. 高亮待合并分支 HEAD。
3. 生成 merge commit 节点（两个 parent edge）。
4. 当前 branch label 与 HEAD 共同移动到 merge commit。
5. 加入提示文字：“merge commit（简化版）”。

---

## 4. 视觉与交互统一规范

### 4.1 节点与边的视觉风格

- 顺序表/栈：矩形块。
- 链表：包含“值”和“next 指针”区域的矩形。
- 树节点：圆或圆角矩形，显示 key 值。
- Git 节点：小圆点 + 可选标签（分支名/标签）。

所有结构中：

- 当前操作焦点：主色高亮（例如蓝色）。
- 即将删除的节点：对比色（例如红色）+ 半透明效果。
- 一般节点：统一中性色。

### 4.2 动画时间与控制

- 单个 micro-step 动画时长建议在 **300–600 ms**。
- 提供全局速度因子（例如 0.5x / 1x / 2x）。
- 必须支持：
  - 播放 / 暂停
  - 单步前进 / 单步后退（或至少单步前进）
  - 重置 / 重播

### 4.3 文本与辅助提示

- 允许在动画旁显示简短说明文字（如“比较：5 < 8，向左走”）。
- 说明文字应可配置显示/隐藏，避免过度干扰。

---

## 5. 与 AnimationOps 的关系

本文件描述的是“**动画应该展示什么**”的教学需求层面。
在实现时：

- Model 与 SceneGraph 应根据这些要求，将一个高层操作拆成若干 AnimationOps 序列。
- AnimationOps 的具体类型与字段将在 `OPS_SPEC.md` 中定义。
- Renderer（PySide6/Web）只负责根据 AnimationOps 实际绘制，不重新决定教学粒度与流程。

**现有如果现有的AnimationOps定义不足以支撑目前的动画要求，应该经过谨慎考虑后扩展**